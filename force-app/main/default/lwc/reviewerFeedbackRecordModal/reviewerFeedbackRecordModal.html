<template>
    <lightning-modal-header label={reviewFeedbackName}></lightning-modal-header>
    <lightning-modal-body>
        <lightning-spinner lwc:if={isLoading} alternative-text="Loading" size="small"></lightning-spinner>
        <div class="slds-modal__content slds-p-horizontal_small slds-p-bottom_small review-modal">
            <div class="slds-box slds-theme_default slds-m-bottom_small">
                <p class="slds-text-title_caps slds-m-bottom_small">Overall Feedback</p>
                <lightning-textarea
                    lwc:if={generalInstructions}
                    class="slds-m-bottom_x-small"
                    label="Additional Instructions"
                    value={generalInstructions}
                    disabled>
                </lightning-textarea>
                <lightning-textarea
                    label="Additional Comments"
                    value={generalComment}
                    onchange={handleGeneralCommentChange}>
                </lightning-textarea>
            </div>
            <template for:each={feedbackFields} for:item="feedbackField">
                <div key={feedbackField.id} class="slds-box slds-m-bottom_medium review-field">
                    <div class="slds-grid slds-wrap slds-gutters">
                        <div class="slds-col slds-size_7-of-12">
                            <p class="slds-text-title_caps">Field</p>
                            <p class="slds-text-body_regular slds-m-bottom_small">{feedbackField.fieldName}</p>

                            <p class="slds-text-title_caps">Value</p>
                            <p lwc:if={feedbackField.value} class="slds-text-body_regular slds-m-bottom_small wrappable-text">{feedbackField.value}</p>
                            <p lwc:else class="slds-text-body_regular slds-m-bottom_small wrappable-text">-</p>

                            <template lwc:if={feedbackField.instructions}>
                                <p class="slds-text-title_caps">Instructions</p>
                                <p class="slds-text-body_regular wrappable-text">{feedbackField.instructions}</p>
                            </template>
                        </div>
                        <div class="slds-col slds-size_5-of-12 slds-p-left_small">
                            <lightning-radio-group
                                data-id={feedbackField.id}
                                name={feedbackField.id}
                                variant="label-hidden"
                                options={validationOptions}
                                value={feedbackField.assessment}
                                onchange={handleFieldValidationChange}
                                type="button"
                                class="slds-m-bottom_small">
                            </lightning-radio-group>

                            <lightning-textarea
                                data-id={feedbackField.id}
                                label="Comment"
                                value={feedbackField.comment}
                                onchange={handleFieldCommentChange}>
                            </lightning-textarea>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </lightning-modal-body>
    <lightning-modal-footer>
        <lightning-button class="slds-m-right_xx-small" label="Save Draft" onclick={handleReviewSave}></lightning-button>
        <lightning-button variant="brand" label="Save & Submit" onclick={handleReviewSubmit}></lightning-button>
    </lightning-modal-footer>
</template>